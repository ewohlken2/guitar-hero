5e476130ef75c254f6afd83c78430abb
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FLAT_TO_SHARP = void 0;
exports.matchChordFromNotes = matchChordFromNotes;
exports.normalizePitchClass = normalizePitchClass;
var FLAT_TO_SHARP = exports.FLAT_TO_SHARP = {
  Db: 'C#',
  Eb: 'D#',
  Fb: 'E',
  Gb: 'F#',
  Ab: 'G#',
  Bb: 'A#',
  Cb: 'B'
};
function normalizePitchClass(pitchClass) {
  var normalized = pitchClass.charAt(0).toUpperCase() + pitchClass.slice(1).toLowerCase();
  if (FLAT_TO_SHARP[normalized]) {
    return FLAT_TO_SHARP[normalized];
  }
  return normalized;
}
var DEFAULT_MIN_CONFIDENCE = 0.5;
var MIN_MATCH_SCORE = 0.5;
function matchChordFromNotes(detectedPitches, chordDatabase, timestamp) {
  var minConfidence = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : DEFAULT_MIN_CONFIDENCE;
  if (detectedPitches.length === 0) {
    return null;
  }
  var confidentPitches = detectedPitches.filter(function (p) {
    return p.confidence >= minConfidence;
  });
  if (confidentPitches.length === 0) {
    return null;
  }
  var detectedNotes = new Set(confidentPitches.map(function (p) {
    return normalizePitchClass(p.note);
  }));
  var bestMatch = null;
  for (var chord of chordDatabase) {
    var chordNotes = new Set(chord.notes.map(normalizePitchClass));
    var score = calculateOverlapScore(detectedNotes, chordNotes);
    if (score > 0 && (!bestMatch || score > bestMatch.score)) {
      bestMatch = {
        chord: chord,
        score: score
      };
    }
  }
  if (!bestMatch || bestMatch.score < MIN_MATCH_SCORE) {
    return null;
  }
  return {
    chord: bestMatch.chord,
    score: bestMatch.score,
    timestamp: timestamp
  };
}
function calculateOverlapScore(detectedNotes, chordNotes) {
  if (chordNotes.size === 0) {
    return 0;
  }
  var matchCount = 0;
  for (var note of chordNotes) {
    if (detectedNotes.has(note)) {
      matchCount++;
    }
  }
  return matchCount / chordNotes.size;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJGTEFUX1RPX1NIQVJQIiwiZXhwb3J0cyIsIkRiIiwiRWIiLCJGYiIsIkdiIiwiQWIiLCJCYiIsIkNiIiwibm9ybWFsaXplUGl0Y2hDbGFzcyIsInBpdGNoQ2xhc3MiLCJub3JtYWxpemVkIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsInRvTG93ZXJDYXNlIiwiREVGQVVMVF9NSU5fQ09ORklERU5DRSIsIk1JTl9NQVRDSF9TQ09SRSIsIm1hdGNoQ2hvcmRGcm9tTm90ZXMiLCJkZXRlY3RlZFBpdGNoZXMiLCJjaG9yZERhdGFiYXNlIiwidGltZXN0YW1wIiwibWluQ29uZmlkZW5jZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImNvbmZpZGVudFBpdGNoZXMiLCJmaWx0ZXIiLCJwIiwiY29uZmlkZW5jZSIsImRldGVjdGVkTm90ZXMiLCJTZXQiLCJtYXAiLCJub3RlIiwiYmVzdE1hdGNoIiwiY2hvcmQiLCJjaG9yZE5vdGVzIiwibm90ZXMiLCJzY29yZSIsImNhbGN1bGF0ZU92ZXJsYXBTY29yZSIsInNpemUiLCJtYXRjaENvdW50IiwiaGFzIl0sInNvdXJjZXMiOlsiY2hvcmRNYXRjaGluZy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaG9yZCwgRGV0ZWN0ZWRQaXRjaCwgRGV0ZWN0ZWRDaG9yZE1hdGNoIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG4vKipcbiAqIE1hcHBpbmcgb2YgZmxhdCBub3RlcyB0byB0aGVpciBzaGFycCBlcXVpdmFsZW50cy5cbiAqIFVzZWQgdG8gbm9ybWFsaXplIHBpdGNoIGRldGVjdGlvbiByZXN1bHRzIGZvciBjb25zaXN0ZW50IGNob3JkIG1hdGNoaW5nLlxuICovXG5leHBvcnQgY29uc3QgRkxBVF9UT19TSEFSUDogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgRGI6ICdDIycsXG4gIEViOiAnRCMnLFxuICBGYjogJ0UnLFxuICBHYjogJ0YjJyxcbiAgQWI6ICdHIycsXG4gIEJiOiAnQSMnLFxuICBDYjogJ0InLFxufTtcblxuLyoqXG4gKiBOb3JtYWxpemVzIGEgcGl0Y2ggY2xhc3MgbmFtZSBieSBjb252ZXJ0aW5nIGZsYXRzIHRvIHNoYXJwcy5cbiAqIFRoaXMgZW5zdXJlcyBjb25zaXN0ZW50IGNvbXBhcmlzb24gYmV0d2VlbiBkZXRlY3RlZCBub3RlcyBhbmQgY2hvcmQgZGF0YWJhc2VzLlxuICpcbiAqIEBwYXJhbSBwaXRjaENsYXNzIC0gVGhlIHBpdGNoIGNsYXNzIHRvIG5vcm1hbGl6ZSAoZS5nLiwgJ0RiJywgJ0MjJywgJ0MnKVxuICogQHJldHVybnMgVGhlIG5vcm1hbGl6ZWQgcGl0Y2ggY2xhc3MgdXNpbmcgc2hhcnBzIChlLmcuLCAnQyMnLCAnQyMnLCAnQycpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVQaXRjaENsYXNzKHBpdGNoQ2xhc3M6IHN0cmluZyk6IHN0cmluZyB7XG4gIC8vIENhcGl0YWxpemUgdGhlIGZpcnN0IGxldHRlciwgbG93ZXJjYXNlIHRoZSByZXN0IGZvciBjb25zaXN0ZW50IGxvb2t1cFxuICBjb25zdCBub3JtYWxpemVkID1cbiAgICBwaXRjaENsYXNzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcGl0Y2hDbGFzcy5zbGljZSgxKS50b0xvd2VyQ2FzZSgpO1xuXG4gIC8vIENoZWNrIGlmIGl0J3MgYSBmbGF0IG5vdGUgYW5kIGNvbnZlcnQgdG8gc2hhcnBcbiAgaWYgKEZMQVRfVE9fU0hBUlBbbm9ybWFsaXplZF0pIHtcbiAgICByZXR1cm4gRkxBVF9UT19TSEFSUFtub3JtYWxpemVkXTtcbiAgfVxuXG4gIC8vIFJldHVybiB0aGUgbm9ybWFsaXplZCB2ZXJzaW9uIChoYW5kbGVzIG5hdHVyYWxzIGFuZCBzaGFycHMpXG4gIHJldHVybiBub3JtYWxpemVkO1xufVxuXG4vKipcbiAqIERlZmF1bHQgbWluaW11bSBjb25maWRlbmNlIHRocmVzaG9sZCBmb3IgcGl0Y2ggZGV0ZWN0aW9uLlxuICovXG5jb25zdCBERUZBVUxUX01JTl9DT05GSURFTkNFID0gMC41O1xuXG4vKipcbiAqIE1pbmltdW0gb3ZlcmxhcCBzY29yZSByZXF1aXJlZCB0byBjb25zaWRlciBhIGNob3JkIG1hdGNoIHZhbGlkLlxuICovXG5jb25zdCBNSU5fTUFUQ0hfU0NPUkUgPSAwLjU7XG5cbi8qKlxuICogTWF0Y2hlcyBkZXRlY3RlZCBwaXRjaCBkYXRhIHRvIHRoZSBiZXN0IG1hdGNoaW5nIGNob3JkIGZyb20gdGhlIGRhdGFiYXNlLlxuICpcbiAqIFRoZSBhbGdvcml0aG06XG4gKiAxLiBGaWx0ZXJzIG91dCBsb3ctY29uZmlkZW5jZSBwaXRjaGVzXG4gKiAyLiBOb3JtYWxpemVzIGFsbCBkZXRlY3RlZCBub3RlcyAoZmxhdHMgdG8gc2hhcnBzKVxuICogMy4gQ2FsY3VsYXRlcyBvdmVybGFwIHNjb3JlIGZvciBlYWNoIGNob3JkIGluIHRoZSBkYXRhYmFzZVxuICogNC4gUmV0dXJucyB0aGUgY2hvcmQgd2l0aCB0aGUgaGlnaGVzdCBzY29yZSBhYm92ZSB0aGUgdGhyZXNob2xkXG4gKlxuICogQHBhcmFtIGRldGVjdGVkUGl0Y2hlcyAtIEFycmF5IG9mIGRldGVjdGVkIHBpdGNoZXMgZnJvbSBhdWRpbyBhbmFseXNpc1xuICogQHBhcmFtIGNob3JkRGF0YWJhc2UgLSBBcnJheSBvZiBjaG9yZHMgdG8gbWF0Y2ggYWdhaW5zdFxuICogQHBhcmFtIHRpbWVzdGFtcCAtIFdoZW4gdGhlIGRldGVjdGlvbiBvY2N1cnJlZFxuICogQHBhcmFtIG1pbkNvbmZpZGVuY2UgLSBNaW5pbXVtIGNvbmZpZGVuY2UgdGhyZXNob2xkIChkZWZhdWx0OiAwLjUpXG4gKiBAcmV0dXJucyBUaGUgYmVzdCBtYXRjaGluZyBjaG9yZCB3aXRoIHNjb3JlLCBvciBudWxsIGlmIG5vIG1hdGNoIGZvdW5kXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYXRjaENob3JkRnJvbU5vdGVzKFxuICBkZXRlY3RlZFBpdGNoZXM6IERldGVjdGVkUGl0Y2hbXSxcbiAgY2hvcmREYXRhYmFzZTogQ2hvcmRbXSxcbiAgdGltZXN0YW1wOiBudW1iZXIsXG4gIG1pbkNvbmZpZGVuY2U6IG51bWJlciA9IERFRkFVTFRfTUlOX0NPTkZJREVOQ0Vcbik6IERldGVjdGVkQ2hvcmRNYXRjaCB8IG51bGwge1xuICAvLyBSZXR1cm4gbnVsbCBpZiBubyBwaXRjaGVzIGRldGVjdGVkXG4gIGlmIChkZXRlY3RlZFBpdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvLyBGaWx0ZXIgcGl0Y2hlcyBieSBjb25maWRlbmNlIHRocmVzaG9sZFxuICBjb25zdCBjb25maWRlbnRQaXRjaGVzID0gZGV0ZWN0ZWRQaXRjaGVzLmZpbHRlcihcbiAgICAocCkgPT4gcC5jb25maWRlbmNlID49IG1pbkNvbmZpZGVuY2VcbiAgKTtcblxuICAvLyBSZXR1cm4gbnVsbCBpZiBubyBwaXRjaGVzIHBhc3MgdGhlIGNvbmZpZGVuY2UgdGhyZXNob2xkXG4gIGlmIChjb25maWRlbnRQaXRjaGVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLy8gTm9ybWFsaXplIGRldGVjdGVkIG5vdGVzIGFuZCByZW1vdmUgZHVwbGljYXRlc1xuICBjb25zdCBkZXRlY3RlZE5vdGVzID0gbmV3IFNldChcbiAgICBjb25maWRlbnRQaXRjaGVzLm1hcCgocCkgPT4gbm9ybWFsaXplUGl0Y2hDbGFzcyhwLm5vdGUpKVxuICApO1xuXG4gIGxldCBiZXN0TWF0Y2g6IHsgY2hvcmQ6IENob3JkOyBzY29yZTogbnVtYmVyIH0gfCBudWxsID0gbnVsbDtcblxuICBmb3IgKGNvbnN0IGNob3JkIG9mIGNob3JkRGF0YWJhc2UpIHtcbiAgICAvLyBOb3JtYWxpemUgY2hvcmQgbm90ZXMgZm9yIGNvbXBhcmlzb25cbiAgICBjb25zdCBjaG9yZE5vdGVzID0gbmV3IFNldChjaG9yZC5ub3Rlcy5tYXAobm9ybWFsaXplUGl0Y2hDbGFzcykpO1xuXG4gICAgLy8gQ2FsY3VsYXRlIG92ZXJsYXAgc2NvcmVcbiAgICBjb25zdCBzY29yZSA9IGNhbGN1bGF0ZU92ZXJsYXBTY29yZShkZXRlY3RlZE5vdGVzLCBjaG9yZE5vdGVzKTtcblxuICAgIC8vIFVwZGF0ZSBiZXN0IG1hdGNoIGlmIHRoaXMgY2hvcmQgaGFzIGEgaGlnaGVyIHNjb3JlXG4gICAgaWYgKHNjb3JlID4gMCAmJiAoIWJlc3RNYXRjaCB8fCBzY29yZSA+IGJlc3RNYXRjaC5zY29yZSkpIHtcbiAgICAgIGJlc3RNYXRjaCA9IHsgY2hvcmQsIHNjb3JlIH07XG4gICAgfVxuICB9XG5cbiAgLy8gUmV0dXJuIG51bGwgaWYgbm8gbWF0Y2ggZm91bmQgb3Igc2NvcmUgdG9vIGxvd1xuICBpZiAoIWJlc3RNYXRjaCB8fCBiZXN0TWF0Y2guc2NvcmUgPCBNSU5fTUFUQ0hfU0NPUkUpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgY2hvcmQ6IGJlc3RNYXRjaC5jaG9yZCxcbiAgICBzY29yZTogYmVzdE1hdGNoLnNjb3JlLFxuICAgIHRpbWVzdGFtcCxcbiAgfTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBvdmVybGFwIHNjb3JlIGJldHdlZW4gZGV0ZWN0ZWQgbm90ZXMgYW5kIGNob3JkIG5vdGVzLlxuICpcbiAqIFNjb3JlIGZvcm11bGE6IChpbnRlcnNlY3Rpb24gc2l6ZSkgLyAoY2hvcmQgbm90ZXMgc2l6ZSlcbiAqIFRoaXMgbWVhc3VyZXMgd2hhdCBwZXJjZW50YWdlIG9mIHRoZSBjaG9yZCdzIG5vdGVzIHdlcmUgZGV0ZWN0ZWQuXG4gKlxuICogQHBhcmFtIGRldGVjdGVkTm90ZXMgLSBTZXQgb2Ygbm9ybWFsaXplZCBkZXRlY3RlZCBub3RlIG5hbWVzXG4gKiBAcGFyYW0gY2hvcmROb3RlcyAtIFNldCBvZiBub3JtYWxpemVkIGNob3JkIG5vdGUgbmFtZXNcbiAqIEByZXR1cm5zIFNjb3JlIGZyb20gMCB0byAxLCB3aGVyZSAxIG1lYW5zIGFsbCBjaG9yZCBub3RlcyB3ZXJlIGRldGVjdGVkXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZU92ZXJsYXBTY29yZShcbiAgZGV0ZWN0ZWROb3RlczogU2V0PHN0cmluZz4sXG4gIGNob3JkTm90ZXM6IFNldDxzdHJpbmc+XG4pOiBudW1iZXIge1xuICBpZiAoY2hvcmROb3Rlcy5zaXplID09PSAwKSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICAvLyBDb3VudCBob3cgbWFueSBjaG9yZCBub3RlcyB3ZXJlIGRldGVjdGVkXG4gIGxldCBtYXRjaENvdW50ID0gMDtcbiAgZm9yIChjb25zdCBub3RlIG9mIGNob3JkTm90ZXMpIHtcbiAgICBpZiAoZGV0ZWN0ZWROb3Rlcy5oYXMobm90ZSkpIHtcbiAgICAgIG1hdGNoQ291bnQrKztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gbWF0Y2hDb3VudCAvIGNob3JkTm90ZXMuc2l6ZTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBTU8sSUFBTUEsYUFBcUMsR0FBQUMsT0FBQSxDQUFBRCxhQUFBLEdBQUc7RUFDbkRFLEVBQUUsRUFBRSxJQUFJO0VBQ1JDLEVBQUUsRUFBRSxJQUFJO0VBQ1JDLEVBQUUsRUFBRSxHQUFHO0VBQ1BDLEVBQUUsRUFBRSxJQUFJO0VBQ1JDLEVBQUUsRUFBRSxJQUFJO0VBQ1JDLEVBQUUsRUFBRSxJQUFJO0VBQ1JDLEVBQUUsRUFBRTtBQUNOLENBQUM7QUFTTSxTQUFTQyxtQkFBbUJBLENBQUNDLFVBQWtCLEVBQVU7RUFFOUQsSUFBTUMsVUFBVSxHQUNkRCxVQUFVLENBQUNFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUMsR0FBR0gsVUFBVSxDQUFDSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQyxDQUFDO0VBR3hFLElBQUlmLGFBQWEsQ0FBQ1csVUFBVSxDQUFDLEVBQUU7SUFDN0IsT0FBT1gsYUFBYSxDQUFDVyxVQUFVLENBQUM7RUFDbEM7RUFHQSxPQUFPQSxVQUFVO0FBQ25CO0FBS0EsSUFBTUssc0JBQXNCLEdBQUcsR0FBRztBQUtsQyxJQUFNQyxlQUFlLEdBQUcsR0FBRztBQWlCcEIsU0FBU0MsbUJBQW1CQSxDQUNqQ0MsZUFBZ0MsRUFDaENDLGFBQXNCLEVBQ3RCQyxTQUFpQixFQUVVO0VBQUEsSUFEM0JDLGFBQXFCLEdBQUFDLFNBQUEsQ0FBQUMsTUFBQSxRQUFBRCxTQUFBLFFBQUFFLFNBQUEsR0FBQUYsU0FBQSxNQUFHUCxzQkFBc0I7RUFHOUMsSUFBSUcsZUFBZSxDQUFDSyxNQUFNLEtBQUssQ0FBQyxFQUFFO0lBQ2hDLE9BQU8sSUFBSTtFQUNiO0VBR0EsSUFBTUUsZ0JBQWdCLEdBQUdQLGVBQWUsQ0FBQ1EsTUFBTSxDQUM3QyxVQUFDQyxDQUFDO0lBQUEsT0FBS0EsQ0FBQyxDQUFDQyxVQUFVLElBQUlQLGFBQWE7RUFBQSxDQUN0QyxDQUFDO0VBR0QsSUFBSUksZ0JBQWdCLENBQUNGLE1BQU0sS0FBSyxDQUFDLEVBQUU7SUFDakMsT0FBTyxJQUFJO0VBQ2I7RUFHQSxJQUFNTSxhQUFhLEdBQUcsSUFBSUMsR0FBRyxDQUMzQkwsZ0JBQWdCLENBQUNNLEdBQUcsQ0FBQyxVQUFDSixDQUFDO0lBQUEsT0FBS25CLG1CQUFtQixDQUFDbUIsQ0FBQyxDQUFDSyxJQUFJLENBQUM7RUFBQSxFQUN6RCxDQUFDO0VBRUQsSUFBSUMsU0FBaUQsR0FBRyxJQUFJO0VBRTVELEtBQUssSUFBTUMsS0FBSyxJQUFJZixhQUFhLEVBQUU7SUFFakMsSUFBTWdCLFVBQVUsR0FBRyxJQUFJTCxHQUFHLENBQUNJLEtBQUssQ0FBQ0UsS0FBSyxDQUFDTCxHQUFHLENBQUN2QixtQkFBbUIsQ0FBQyxDQUFDO0lBR2hFLElBQU02QixLQUFLLEdBQUdDLHFCQUFxQixDQUFDVCxhQUFhLEVBQUVNLFVBQVUsQ0FBQztJQUc5RCxJQUFJRSxLQUFLLEdBQUcsQ0FBQyxLQUFLLENBQUNKLFNBQVMsSUFBSUksS0FBSyxHQUFHSixTQUFTLENBQUNJLEtBQUssQ0FBQyxFQUFFO01BQ3hESixTQUFTLEdBQUc7UUFBRUMsS0FBSyxFQUFMQSxLQUFLO1FBQUVHLEtBQUssRUFBTEE7TUFBTSxDQUFDO0lBQzlCO0VBQ0Y7RUFHQSxJQUFJLENBQUNKLFNBQVMsSUFBSUEsU0FBUyxDQUFDSSxLQUFLLEdBQUdyQixlQUFlLEVBQUU7SUFDbkQsT0FBTyxJQUFJO0VBQ2I7RUFFQSxPQUFPO0lBQ0xrQixLQUFLLEVBQUVELFNBQVMsQ0FBQ0MsS0FBSztJQUN0QkcsS0FBSyxFQUFFSixTQUFTLENBQUNJLEtBQUs7SUFDdEJqQixTQUFTLEVBQVRBO0VBQ0YsQ0FBQztBQUNIO0FBWUEsU0FBU2tCLHFCQUFxQkEsQ0FDNUJULGFBQTBCLEVBQzFCTSxVQUF1QixFQUNmO0VBQ1IsSUFBSUEsVUFBVSxDQUFDSSxJQUFJLEtBQUssQ0FBQyxFQUFFO0lBQ3pCLE9BQU8sQ0FBQztFQUNWO0VBR0EsSUFBSUMsVUFBVSxHQUFHLENBQUM7RUFDbEIsS0FBSyxJQUFNUixJQUFJLElBQUlHLFVBQVUsRUFBRTtJQUM3QixJQUFJTixhQUFhLENBQUNZLEdBQUcsQ0FBQ1QsSUFBSSxDQUFDLEVBQUU7TUFDM0JRLFVBQVUsRUFBRTtJQUNkO0VBQ0Y7RUFFQSxPQUFPQSxVQUFVLEdBQUdMLFVBQVUsQ0FBQ0ksSUFBSTtBQUNyQyIsImlnbm9yZUxpc3QiOltdfQ==